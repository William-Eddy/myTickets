{% extends "standardPage.html" %}

{% set title = "Venue Ticket Options" %}

{% block content %}
{{ super() }}

<div class="eventImageWrapper">
  <img class="spanBlurImage" src="/static/media/{{performanceData[5]}}" style="height:180px;">
  <div class="peformanceTextOverlay">
    <img class="eventImageRounded" src="/static/media/{{performanceData[5]}}">
    <div class="performanceInfo">
      <h2 class="bold">{{performanceData[6]}}</h2>
      <h3 class="bold">{{performanceData[7]}}</h3>
      <h4>{{performanceData[2]}} - {{performanceData[1]}}</h4>
      <h4>{{performanceData[3]}} @ {{performanceData[8]}}</h4>
    </div>
  </div>
</div>

<div class="ticketOption">
  <h1>Ticket Options</h1>
  <table>
    <tr>
      <th>Ticket</th>
      <th>Price</th>
    </tr>
    {% for ticket in ticketOptions %}
    <tr>
      <td style="width:43%;">{{ticket[1]}}</td>
      <td style="width:24%;">£{{ticket[2]}}</td>
      <td class="ticketQuantityOptions">
        {% if ticket[3] == 0 %}
          <form onSubmit="return false" onClick="return decreaseTicketQuantity({{ticket[0]}})">
            <input type="submit" class="button round" value=" - " />
          </form>
          <form id="ticketTypeQuantites{{ticket[0]}}">
            <input type="text" id="ticketQuantity" name="ticketQuantity" style="width:35px;text-align: center;" value="0">
          </form>
          <form onSubmit="return false" onClick="return increaseTicketQuantity({{ticket[0]}})">
            <input type="submit" class="button round" value=" + " />
          </form>

        {% else %}
          <h5 class="soldOutMessage">--- SOLD OUT ---</h5>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>

  <h2 id="totalTicketValue">Total: £0.00</h2>

  <form onsubmit="return false" onClick="return checkout()">
    <input type="submit" class="button largeButton" value="Checkout" />
  </form>

</div>


<div class="splitFlex">

  <div class="venueSteaingImagePlaceholder">
    <img src="/static/media/{{performanceData[4]}}" class="venueSteatingImage">
  </div>

</div>


<div class="errorMessage">
  <img class="icon" src="/static/media/warning.png">
  <div class="errorMessageText">
    <h4>The maximum tickets per household is {{performanceData[9]}}</h4>
  </div>
</div>

{% endblock %}

{% block script %}
{{ super() }}

<script>

  function increaseTicketQuantity(peformanceTicketTypeID){
    changeTicketQuantity(peformanceTicketTypeID, 1);
  }

  function decreaseTicketQuantity(peformanceTicketTypeID){
    changeTicketQuantity(peformanceTicketTypeID, -1);
  }

</script>

<script>

  function totalTicketQuantity(){
    var totalQuantity = 0;
    {% for ticket in ticketOptions %}
      totalQuantity += + document.forms["ticketTypeQuantites{{ticket[0]}}"]["ticketQuantity"].value;
    {% endfor %}
    return totalQuantity;
  }

</script>

<script>

  function changeTicketQuantity(peformanceTicketTypeID, increase){
    exisitngQuantity = document.forms["ticketTypeQuantites" + peformanceTicketTypeID]["ticketQuantity"].value;
    proposedQuantity = parseInt(exisitngQuantity) + parseInt(increase)
    if (proposedQuantity < 0){
      console.log("Ticket already at 0")
    }
    else if ((totalTicketQuantity() + increase) > {{performanceData[9]}}){
      console.log("Ticket limit reached!")
    }
    else{
      document.forms["ticketTypeQuantites" + peformanceTicketTypeID]["ticketQuantity"].value = proposedQuantity;
    }
    setTotalOrderValueText()
  }


  function getTotalOrderValue(){
    var ticketQuantity = 0;
    var totalCost = 0.00;
    {% for ticket in ticketOptions %}
      ticketQuantity = document.forms["ticketTypeQuantites{{ticket[0]}}"]["ticketQuantity"].value;
      totalCost += {{ticket[2]}} * ticketQuantity;
    {% endfor %}
    return totalCost;
  }

  function setTotalOrderValueText(){
    document.getElementById("totalTicketValue").innerHTML = "Total: £" + getTotalOrderValue().toFixed(2);
  }

</script>

<script>

  function checkout() {

    ticketList = "";

    {% for ticket in ticketOptions %}
      ticketList += "{{ticket[0]}}." + document.forms["ticketTypeQuantites{{ticket[0]}}"]["ticketQuantity"].value + "/";
    {% endfor %}

    document.cookie = "performanceID={{performanceData[0]}}; path=/";
    document.cookie = "tickets=" + ticketList + "; path=/";

    window.location.href = "/checkout/payment";
  }

</script>

{% endblock %}
